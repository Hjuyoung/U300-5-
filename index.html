<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìŒì„± ê¸°ë°˜ ì˜ë†ì¼ì§€ ì‹œìŠ¤í…œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }

    .tabs {
      display: flex;
      background: #f8f9fa;
      border-bottom: 2px solid #e9ecef;
    }

    .tab {
      flex: 1;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      background: white;
      border: none;
      font-size: 16px;
      transition: all 0.3s;
      border-bottom: 3px solid transparent;
    }

    .tab:hover {
      background: #f8f9fa;
    }

    .tab.active {
      border-bottom: 3px solid #667eea;
      background: #f8f9fa;
      font-weight: bold;
      color: #667eea;
    }

    .tab-content {
      display: none;
      padding: 30px;
    }

    .tab-content.active {
      display: block;
    }

    .input-section {
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 30px;
    }

    .voice-button {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 48px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      margin: 0 auto;
      display: block;
    }

    .voice-button:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    }

    .voice-button.listening {
      animation: pulse 1.5s infinite;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .status-text {
      text-align: center;
      margin-top: 15px;
      font-size: 18px;
      color: #667eea;
      font-weight: 600;
      min-height: 30px;
    }

    .text-input-area {
      margin-top: 20px;
    }

    textarea {
      width: 100%;
      padding: 15px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-size: 16px;
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .submit-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 15px;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .submit-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .record-card {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.3s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .record-card:hover {
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    .record-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f8f9fa;
    }

    .record-date {
      font-weight: bold;
      color: #667eea;
      font-size: 16px;
    }

    .delete-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    .delete-btn:hover {
      background: #c82333;
    }

    .record-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .info-item {
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .info-label {
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 15px;
      font-weight: 600;
      color: #212529;
    }

    .raw-text {
      margin-top: 10px;
      padding: 10px;
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      border-radius: 5px;
      font-style: italic;
      color: #856404;
    }

    .diary-controls {
      display: flex;
      gap: 15px;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .diary-controls select {
      padding: 10px 15px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    .diary-output {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 15px;
      padding: 30px;
      min-height: 200px;
    }

    .diary-title {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #212529;
    }

    .diary-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .diary-table th,
    .diary-table td {
      border: 1px solid #dee2e6;
      padding: 12px;
      text-align: left;
    }

    .diary-table th {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: 600;
    }

    .diary-table tr:nth-child(even) {
      background: #f8f9fa;
    }

    .stats-container {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 40px;
      color: white;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }

    .stat-number {
      font-size: 48px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 10px;
    }

    .stat-label {
      font-size: 16px;
      color: #6c757d;
    }

    .category-section {
      background: white;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 20px;
    }

    .category-title {
      font-size: 20px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .category-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .category-tag {
      padding: 8px 16px;
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
      border: 2px solid #667eea;
      border-radius: 20px;
      font-size: 14px;
      color: #667eea;
      font-weight: 600;
    }

    .help-text {
      background: #e7f3ff;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      color: #004085;
      border-left: 4px solid #0066cc;
    }

    .empty-state {
      text-align: center;
      padding: 50px;
      color: #6c757d;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .container {
        border-radius: 0;
      }
      
      .tabs {
        flex-direction: column;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸŒ¾ ìŒì„± ê¸°ë°˜ ì˜ë†ì¼ì§€ ì‹œìŠ¤í…œ</h1>
      <p>ìŒì„±ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ë†ì—… ì‘ì—…ì„ ê¸°ë¡í•˜ì„¸ìš”</p>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('input')">ğŸ“ ì¼ì§€ ì…ë ¥</button>
      <button class="tab" onclick="switchTab('list')">ğŸ“‹ ê¸°ë¡ ëª©ë¡</button>
      <button class="tab" onclick="switchTab('diary')">ğŸ“… ì˜ë†ì¼ì§€ ì¶œë ¥</button>
      <button class="tab" onclick="switchTab('stats')">ğŸ“Š í†µê³„</button>
    </div>

    <!-- ì…ë ¥ íƒ­ -->
    <div id="input-tab" class="tab-content active">
      <div class="help-text">
        ğŸ’¡ <strong>ì‚¬ìš© ë°©ë²•:</strong> ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìŒì„±ìœ¼ë¡œ ì‘ì—… ë‚´ìš©ì„ ë§í•˜ê±°ë‚˜, ì•„ë˜ í…ìŠ¤íŠ¸ ì…ë ¥ë€ì— ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.
        <br>ì˜ˆ: "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“ ì˜ì–‘ì œ ì‚´í¬í–ˆì–´", "ì‚¬ê³¼ 50kg ìˆ˜í™•", "í† ë§ˆí†  ë¬¼ì£¼ê¸°"
        <br><br>
        ğŸ”Š <strong>ì‹œë„ëŸ¬ìš´ í™˜ê²½ì—ì„œ ì‚¬ìš© íŒ:</strong>
        <br>â€¢ ğŸ“± ë§ˆì´í¬ì— <strong>10~20cm ê±°ë¦¬</strong>ë¡œ ê°€ê¹Œì´ ëŒ€ê³  ë§í•˜ì„¸ìš”
        <br>â€¢ ğŸ—£ï¸ <strong>ì²œì²œíˆ, ë˜ë°•ë˜ë°•</strong> ë°œìŒí•˜ì„¸ìš”
        <br>â€¢ â¸ï¸ ë‹¨ì–´ ì‚¬ì´ì— <strong>ì§§ì€ ì‰¼</strong>ì„ ë„£ìœ¼ì„¸ìš”
        <br>â€¢ ğŸ¯ ì¸ì‹ ì‹ ë¢°ë„ê°€ í‘œì‹œë˜ë‹ˆ ë‚®ìœ¼ë©´ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”
        <br>â€¢ ğŸ”„ ì˜¤ë¥˜ ì‹œ <strong>ìë™ ì¬ì‹œë„</strong>ë˜ë‹ˆ ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”
      </div>

      <div class="input-section">
        <button id="voiceBtn" class="voice-button" onclick="toggleVoiceRecognition()">ğŸ¤</button>
        <div id="statusText" class="status-text">ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”</div>
        
        <div class="text-input-area">
          <textarea id="textInput" placeholder="ì—¬ê¸°ì— ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ìŒì„±ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
          <button class="submit-button" onclick="submitText()">âœ… ê¸°ë¡ ì €ì¥</button>
        </div>
      </div>

      <div id="currentRecordDisplay"></div>
    </div>

    <!-- ëª©ë¡ íƒ­ -->
    <div id="list-tab" class="tab-content">
      <h2 id="recordsTitle" style="margin-bottom: 20px; color: #667eea; font-size: 24px;"></h2>
      <div id="recordsList"></div>
    </div>

    <!-- ì˜ë†ì¼ì§€ ì¶œë ¥ íƒ­ -->
    <div id="diary-tab" class="tab-content">
      <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px; text-align: center;">ğŸ“… ì˜ë†ì¼ì§€ ì¶œë ¥</h3>
        <div style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap;">
          <div style="display: flex; align-items: center; gap: 10px;">
            <label style="font-size: 18px; font-weight: 600; color: #495057;">ì—°ë„:</label>
            <select id="diaryYear" style="padding: 12px 20px; border: 2px solid #667eea; border-radius: 10px; font-size: 18px; font-weight: 600; cursor: pointer; background: white; color: #667eea; min-width: 120px;">
              <option value="2023">2023ë…„</option>
              <option value="2024">2024ë…„</option>
              <option value="2025" selected>2025ë…„</option>
              <option value="2026">2026ë…„</option>
            </select>
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <label style="font-size: 18px; font-weight: 600; color: #495057;">ì›”:</label>
            <select id="diaryMonth" style="padding: 12px 20px; border: 2px solid #667eea; border-radius: 10px; font-size: 18px; font-weight: 600; cursor: pointer; background: white; color: #667eea; min-width: 100px;">
              <option value="1">1ì›”</option>
              <option value="2">2ì›”</option>
              <option value="3">3ì›”</option>
              <option value="4">4ì›”</option>
              <option value="5">5ì›”</option>
              <option value="6">6ì›”</option>
              <option value="7">7ì›”</option>
              <option value="8">8ì›”</option>
              <option value="9">9ì›”</option>
              <option value="10" selected>10ì›”</option>
              <option value="11">11ì›”</option>
              <option value="12">12ì›”</option>
            </select>
          </div>
          <button class="submit-button" onclick="generateDiary()" style="padding: 12px 30px; font-size: 16px;">ğŸ“… ì˜ë†ì¼ì§€ ìƒì„±</button>
        </div>
      </div>
      <div id="diaryOutput" class="diary-output"></div>
    </div>

    <!-- í†µê³„ íƒ­ -->
    <div id="stats-tab" class="tab-content">
      <div class="stats-container">
        <h2 style="margin-bottom: 30px; font-size: 28px;">ğŸ“Š ì˜ë†ì¼ì§€ í†µê³„</h2>
        
        <!-- ì „ì²´ í†µê³„ -->
        <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px;">
          <h3 style="color: #667eea; margin-bottom: 20px; font-size: 20px;">ğŸ“ˆ ì „ì²´ í†µê³„</h3>
          <div class="stats-grid" id="overallStats"></div>
        </div>

        <!-- ì‘ë¬¼ ë¶„ë¥˜ í†µê³„ -->
        <div class="category-section" id="cropStats">
          <div class="category-title">ğŸŒ± ì‘ë¬¼ ë¶„ë¥˜</div>
          <div id="cropStatsContent"></div>
        </div>

        <!-- ì‘ë¬¼ë³„ ìƒì„¸ í†µê³„ -->
        <div class="category-section" id="cropDetails">
          <div class="category-title">ğŸ“Š ì‘ë¬¼ë³„ ê¸°ë¡ íšŸìˆ˜ (Xì¢…)</div>
          <div id="cropDetailsContent" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
        </div>

        <!-- ì‘ì—… ì¢…ë¥˜ í†µê³„ -->
        <div class="category-section" id="workStats">
          <div class="category-title">ğŸ”§ ì‘ì—… ì¢…ë¥˜ (Xì¢…)</div>
          <div id="workStatsContent" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
        </div>

        <!-- í’ˆì§ˆ/ë“±ê¸‰ í†µê³„ -->
        <div class="category-section" id="gradeStats">
          <div class="category-title">â­ í’ˆì§ˆ/ë“±ê¸‰</div>
          <div id="gradeStatsContent" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
        </div>

        <!-- ì €ì¥ ì¥ì†Œ í†µê³„ -->
        <div class="category-section" id="storageStats">
          <div class="category-title">ğŸ­ ì €ì¥ ì¥ì†Œ</div>
          <div id="storageStatsContent" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
        </div>

        <!-- ì¶œí•˜ì²˜ í†µê³„ -->
        <div class="category-section" id="destinationStats">
          <div class="category-title">ğŸª ì¶œí•˜ì²˜/íŒë§¤ì²˜</div>
          <div id="destinationStatsContent" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let records = [];
    let recognition = null;
    let isListening = false;

    // Web Speech API ì´ˆê¸°í™” (ê°œì„ ëœ ë²„ì „)
    function initSpeechRecognition() {
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
        return false;
      }

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      
      // ğŸ”Š ì‹œë„ëŸ¬ìš´ í™˜ê²½ì„ ìœ„í•œ ìŒì„± ì¸ì‹ ìµœì í™” ì„¤ì •
      recognition.lang = 'ko-KR';
      recognition.continuous = false; // ì—°ì† ì¸ì‹ ë¹„í™œì„±í™” (ë” ì•ˆì •ì )
      recognition.interimResults = true; // ì¤‘ê°„ ê²°ê³¼ í‘œì‹œ
      recognition.maxAlternatives = 3; // ğŸ¯ ëŒ€ì•ˆ ê°œìˆ˜ ì¦ê°€ (ì†ŒìŒ í™˜ê²½ ëŒ€ì‘)
      
      // â±ï¸ ìŒì„± ê°ì§€ íƒ€ì„ì•„ì›ƒ ì„¤ì • (ë” ê¸´ ëŒ€ê¸° ì‹œê°„)
      // ì£¼ì˜: ì´ ì„¤ì •ë“¤ì€ ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì›ë˜ì§€ ì•Šì„ ìˆ˜ ìˆì§€ë§Œ ì‹œë„í•´ë³¼ ê°€ì¹˜ê°€ ìˆìŒ
      if (recognition.hasOwnProperty('speechTimeout')) {
        recognition.speechTimeout = 5000; // 5ì´ˆ
      }
      if (recognition.hasOwnProperty('audiostart')) {
        // ì˜¤ë””ì˜¤ ì‹œì‘ ê°ì§€ë¥¼ ìœ„í•œ ì„¤ì •
      }

      recognition.onstart = function() {
        isListening = true;
        document.getElementById('voiceBtn').classList.add('listening');
        document.getElementById('statusText').textContent = 'ğŸ¤ ë“£ê³  ìˆìŠµë‹ˆë‹¤... ë§ì”€í•˜ì„¸ìš”!';
      };

      recognition.onresult = function(event) {
        let interimTranscript = '';
        let finalTranscript = '';
        let confidence = 0;

        for (let i = event.resultIndex; i < event.results.length; i++) {
          const result = event.results[i];
          const transcript = result[0].transcript;
          
          // ğŸ¯ ì‹ ë¢°ë„ í™•ì¸ (0.0 ~ 1.0)
          if (result.isFinal && result[0].confidence) {
            confidence = result[0].confidence;
          }
          
          if (result.isFinal) {
            finalTranscript += transcript;
          } else {
            interimTranscript += transcript;
          }
        }

        // ì‹¤ì‹œê°„ìœ¼ë¡œ ì¸ì‹ ì¤‘ì¸ í…ìŠ¤íŠ¸ í‘œì‹œ
        if (interimTranscript) {
          document.getElementById('statusText').textContent = `ğŸ¤ ì¸ì‹ ì¤‘: ${interimTranscript}`;
          document.getElementById('statusText').style.color = '#ff9800';
        }

        // ìµœì¢… ì¸ì‹ ê²°ê³¼ ì²˜ë¦¬
        if (finalTranscript) {
          const currentText = document.getElementById('textInput').value;
          const newText = currentText ? currentText + ' ' + finalTranscript : finalTranscript;
          document.getElementById('textInput').value = newText;
          
          // ğŸ“Š ì‹ ë¢°ë„ì— ë”°ë¥¸ í”¼ë“œë°±
          const confidencePercent = Math.round(confidence * 100);
          let feedbackEmoji = 'âœ…';
          let feedbackColor = '#4caf50';
          
          if (confidence > 0 && confidence < 0.6) {
            feedbackEmoji = 'âš ï¸';
            feedbackColor = '#ff9800';
            document.getElementById('statusText').textContent = 
              `${feedbackEmoji} ì¸ì‹ ì™„ë£Œ (ì‹ ë¢°ë„: ${confidencePercent}%) - ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”: ${finalTranscript}`;
          } else if (confidence >= 0.6) {
            document.getElementById('statusText').textContent = 
              `${feedbackEmoji} ì¸ì‹ ì™„ë£Œ (ì‹ ë¢°ë„: ${confidencePercent}%): ${finalTranscript}`;
          } else {
            // ì‹ ë¢°ë„ ì •ë³´ê°€ ì—†ëŠ” ê²½ìš° (ì¼ë¶€ ë¸Œë¼ìš°ì €)
            document.getElementById('statusText').textContent = 
              `${feedbackEmoji} ì¸ì‹ ì™„ë£Œ: ${finalTranscript}`;
          }
          
          document.getElementById('statusText').style.color = feedbackColor;
          document.getElementById('statusText').style.fontWeight = 'bold';
          
          // â±ï¸ 1ì´ˆ í›„ ìë™ìœ¼ë¡œ ì €ì¥ (ì‹ ë¢°ë„ê°€ ë‚®ìœ¼ë©´ 1.5ì´ˆ)
          const saveDelay = (confidence > 0 && confidence < 0.6) ? 1500 : 1000;
          setTimeout(() => {
            if (document.getElementById('textInput').value.trim()) {
              submitText();
            }
          }, saveDelay);
        }
      };

      recognition.onerror = function(event) {
        console.error('ìŒì„± ì¸ì‹ ì˜¤ë¥˜:', event.error);
        isListening = false;
        document.getElementById('voiceBtn').classList.remove('listening');
        
        let errorMessage = 'ìŒì„± ì¸ì‹ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        let shouldRetry = false;
        
        switch(event.error) {
          case 'no-speech':
            errorMessage = 'ğŸ”‡ ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë§ˆì´í¬ì— ë” ê°€ê¹Œì´ ëŒ€ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
            shouldRetry = true;
            break;
          case 'audio-capture':
            errorMessage = 'ğŸ¤ ë§ˆì´í¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§ˆì´í¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
            break;
          case 'not-allowed':
            errorMessage = 'â›” ë§ˆì´í¬ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
            break;
          case 'network':
            errorMessage = 'ğŸ“¡ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
            shouldRetry = true;
            break;
          case 'aborted':
            errorMessage = 'â¸ï¸ ìŒì„± ì¸ì‹ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.';
            shouldRetry = true;
            break;
          case 'service-not-allowed':
            errorMessage = 'ğŸš« ìŒì„± ì¸ì‹ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            break;
        }
        
        document.getElementById('statusText').textContent = `âŒ ${errorMessage}`;
        document.getElementById('statusText').style.color = '#f44336';
        
        // ğŸ”„ ìë™ ì¬ì‹œë„ (no-speech, network, aborted ì˜¤ë¥˜ì˜ ê²½ìš°)
        if (shouldRetry) {
          setTimeout(() => {
            document.getElementById('statusText').textContent = 'ğŸ”„ 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ì¬ì‹œë„í•©ë‹ˆë‹¤...';
            setTimeout(() => {
              if (!isListening) {
                toggleVoiceRecognition();
              }
            }, 3000);
          }, 1000);
        } else {
          // ì¬ì‹œë„ ë¶ˆê°€ëŠ¥í•œ ì˜¤ë¥˜ëŠ” 5ì´ˆ í›„ ìƒíƒœ ë©”ì‹œì§€ ì´ˆê¸°í™”
          setTimeout(() => {
            document.getElementById('statusText').textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”';
            document.getElementById('statusText').style.color = '#666';
            document.getElementById('statusText').style.fontWeight = 'normal';
          }, 5000);
        }
      };

      recognition.onend = function() {
        isListening = false;
        document.getElementById('voiceBtn').classList.remove('listening');
        
        // ì¸ì‹ì´ ì •ìƒ ì¢…ë£Œëœ ê²½ìš°
        if (document.getElementById('textInput').value) {
          setTimeout(() => {
            document.getElementById('statusText').textContent = 'ì…ë ¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
          }, 1000);
        } else {
          setTimeout(() => {
            document.getElementById('statusText').textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”';
          }, 2000);
        }
      };

      return true;
    }

    // ìŒì„± ì¸ì‹ í† ê¸€
    function toggleVoiceRecognition() {
      if (!recognition && !initSpeechRecognition()) {
        return;
      }

      if (isListening) {
        recognition.stop();
        document.getElementById('statusText').textContent = 'ìŒì„± ì¸ì‹ì„ ì¤‘ì§€í–ˆìŠµë‹ˆë‹¤.';
      } else {
        try {
          recognition.start();
        } catch (e) {
          console.error('ìŒì„± ì¸ì‹ ì‹œì‘ ì˜¤ë¥˜:', e);
          document.getElementById('statusText').textContent = 'ìŒì„± ì¸ì‹ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        }
      }
    }

    // ë‚ ì”¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (Open-Meteo API ì‚¬ìš© - ë¬´ë£Œ, API í‚¤ ë¶ˆí•„ìš”)
    async function getWeatherData(date) {
      try {
        // ì‚¬ìš©ì ìœ„ì¹˜ ì •ë³´ (ì¸ì²œ)
        const lat = 37.4563;
        const lon = 126.7052;
        
        // í˜„ì¬ ë‚ ì”¨ ê°€ì ¸ì˜¤ê¸° (ìµœê·¼ ê¸°ë¡ì¸ ê²½ìš°)
        const now = new Date();
        const recordDate = new Date(date);
        const diffDays = Math.floor((now - recordDate) / (1000 * 60 * 60 * 24));
        
        if (diffDays <= 0) {
          // ì˜¤ëŠ˜ ë‚ ì”¨ - Open-Meteo API ì‚¬ìš©
          const response = await fetch(
            `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m&timezone=Asia/Seoul`
          );
          
          if (response.ok) {
            const data = await response.json();
            if (data.current) {
              return {
                temp: Math.round(data.current.temperature_2m),
                humidity: Math.round(data.current.relative_humidity_2m)
              };
            }
          }
        }
        
        // ê³¼ê±° ë‚ ì§œì´ê±°ë‚˜ API ì‹¤íŒ¨ ì‹œ - í•œêµ­ ê³„ì ˆë³„ í‰ê· ê°’ ì‚¬ìš©
        const month = recordDate.getMonth() + 1;
        let avgTemp, avgHumidity;
        
        // ê³„ì ˆë³„ í‰ê·  ê¸°ì˜¨ê³¼ ìŠµë„
        if (month >= 3 && month <= 5) { // ë´„
          avgTemp = 13;
          avgHumidity = 60;
        } else if (month >= 6 && month <= 8) { // ì—¬ë¦„
          avgTemp = 25;
          avgHumidity = 75;
        } else if (month >= 9 && month <= 11) { // ê°€ì„
          avgTemp = 15;
          avgHumidity = 65;
        } else { // ê²¨ìš¸
          avgTemp = 2;
          avgHumidity = 60;
        }
        
        return {
          temp: Math.round(avgTemp + (Math.random() - 0.5) * 6), // Â±3ë„ ë³€ë™
          humidity: Math.round(avgHumidity + (Math.random() - 0.5) * 20) // Â±10% ë³€ë™
        };
      } catch (error) {
        console.error('ë‚ ì”¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
        // ê¸°ë³¸ê°’ ë°˜í™˜
        return {
          temp: 20,
          humidity: 65
        };
      }
    }

    // í…ìŠ¤íŠ¸ ì œì¶œ (ë‚ ì”¨ ì •ë³´ í¬í•¨)
    async function submitText() {
      const text = document.getElementById('textInput').value.trim();
      if (!text) {
        alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const record = analyzeText(text);
      
      // ë‚ ì”¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const weather = await getWeatherData(record.date);
      record.temperature = weather.temp;
      record.humidity = weather.humidity;
      
      records.push(record);
      saveRecords();
      
      document.getElementById('textInput').value = '';
      displayCurrentRecord(record);
      updateAllDisplays();
      
      document.getElementById('statusText').textContent = 'âœ… ìë™ìœ¼ë¡œ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!';
      setTimeout(() => {
        document.getElementById('statusText').textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ìŒ ê¸°ë¡ì„ ì‹œì‘í•˜ì„¸ìš”';
      }, 2000);
    }

    // í…ìŠ¤íŠ¸ ë¶„ì„
    function analyzeText(text) {
      const now = new Date();
      const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;

      // ì‘ë¬¼ í‚¤ì›Œë“œ (ëŒ€í­ í™•ì¥)
      const crops = {
        // ê³¼ìˆ˜ë¥˜
        'ì‚¬ê³¼': 'ì‚¬ê³¼', 'ë°°': 'ë°°', 'ë³µìˆ­ì•„': 'ë³µìˆ­ì•„', 'ê°': 'ê°', 'ìë‘': 'ìë‘',
        'ë°¤': 'ë°¤', 'ëŒ€ì¶”': 'ëŒ€ì¶”', 'ë§¤ì‹¤': 'ë§¤ì‹¤', 'ì‚´êµ¬': 'ì‚´êµ¬', 'ì•µë‘': 'ì•µë‘',
        'ê°ê·¤': 'ê°ê·¤', 'ê·¤': 'ê·¤', 'í•œë¼ë´‰': 'í•œë¼ë´‰', 'ì²œí˜œí–¥': 'ì²œí˜œí–¥', 'ë ˆë“œí–¥': 'ë ˆë“œí–¥',
        'ë”¸ê¸°': 'ë”¸ê¸°', 'ë¸”ë£¨ë² ë¦¬': 'ë¸”ë£¨ë² ë¦¬', 'í‚¤ìœ„': 'í‚¤ìœ„', 'ë¬´í™”ê³¼': 'ë¬´í™”ê³¼', 
        'ì„ë¥˜': 'ì„ë¥˜', 'ì˜¤ë””': 'ì˜¤ë””',
        
        // í¬ë„ë¥˜ (23ì¢… ì¶”ê°€!)
        'í¬ë„': 'í¬ë„',
        'ìƒ¤ì¸ë¨¸ìŠ¤ì¼“': 'ìƒ¤ì¸ë¨¸ìŠ¤ì¼“', 'ìƒ¤ì¸ë¨¸ìŠ¤ìº£': 'ìƒ¤ì¸ë¨¸ìŠ¤ì¼“', 'ìƒ¤ì¸': 'ìƒ¤ì¸ë¨¸ìŠ¤ì¼“',
        'ìº ë²¨ì–¼ë¦¬': 'ìº ë²¨ì–¼ë¦¬', 'ìº ë²¨': 'ìº ë²¨ì–¼ë¦¬', 'ìº ë°¸': 'ìº ë²¨ì–¼ë¦¬',
        'ê±°ë´‰': 'ê±°ë´‰',
        'MBA': 'MBA', 'ë¨¸ìŠ¤ìº‡ë² ì¼ë¦¬A': 'MBA', 'ë¨¸ìŠ¤ìº‡ë² ì¼ë¦¬': 'MBA',
        'ì²­í¬ë‘': 'ì²­í¬ë‘',
        'í†°ìŠ¨ì”¨ë“¤ë¦¬ìŠ¤': 'í†°ìŠ¨ì”¨ë“¤ë¦¬ìŠ¤', 'í†°ìŠ¨': 'í†°ìŠ¨ì”¨ë“¤ë¦¬ìŠ¤',
        'í™ì£¼ì”¨ë“¤ë¦¬ìŠ¤': 'í™ì£¼ì”¨ë“¤ë¦¬ìŠ¤', 'í™ì£¼': 'í™ì£¼ì”¨ë“¤ë¦¬ìŠ¤', 'ë ˆë“œìƒ¤ì¸': 'í™ì£¼ì”¨ë“¤ë¦¬ìŠ¤',
        'í™ë¶€ì‚¬': 'í™ë¶€ì‚¬',
        'ë°”ì´ì˜¬ë ›í‚¹': 'ë°”ì´ì˜¬ë ›í‚¹', 'ë°”ì´ì˜¬ë ›': 'ë°”ì´ì˜¬ë ›í‚¹',
        'ìŠ¤í…”ë¼': 'ìŠ¤í…”ë¼',
        'í‘êµ¬ìŠ¬': 'í‘êµ¬ìŠ¬',
        'ì¶©ë‘': 'ì¶©ë‘',
        'ì‚¬íŒŒì´ì–´': 'ì‚¬íŒŒì´ì–´',
        
        // ì±„ì†Œë¥˜
        'í† ë§ˆí† ': 'í† ë§ˆí† ', 'ë°©ìš¸í† ë§ˆí† ': 'ë°©ìš¸í† ë§ˆí† ', 'ì˜¤ì´': 'ì˜¤ì´', 'ê³ ì¶”': 'ê³ ì¶”', 
        'ê°€ì§€': 'ê°€ì§€', 'í˜¸ë°•': 'í˜¸ë°•', 'í”¼ë§': 'í”¼ë§', 'íŒŒí”„ë¦¬ì¹´': 'íŒŒí”„ë¦¬ì¹´',
        'ìƒì¶”': 'ìƒì¶”', 'ë°°ì¶”': 'ë°°ì¶”', 'ë¬´': 'ë¬´', 'ë‹¹ê·¼': 'ë‹¹ê·¼', 'ì–‘íŒŒ': 'ì–‘íŒŒ',
        'ë§ˆëŠ˜': 'ë§ˆëŠ˜', 'íŒŒ': 'íŒŒ', 'ìª½íŒŒ': 'ìª½íŒŒ', 'ëŒ€íŒŒ': 'ëŒ€íŒŒ',
        'ì‹œê¸ˆì¹˜': 'ì‹œê¸ˆì¹˜', 'ê¹»ì': 'ê¹»ì', 'ë¸Œë¡œì½œë¦¬': 'ë¸Œë¡œì½œë¦¬',
        
        // ë‘ë¥˜/ì„œë¥˜
        'ì½©': 'ì½©', 'ì™„ë‘ì½©': 'ì™„ë‘ì½©', 'ê°•ë‚­ì½©': 'ê°•ë‚­ì½©', 'ë•…ì½©': 'ë•…ì½©',
        'ê°ì': 'ê°ì', 'ê³ êµ¬ë§ˆ': 'ê³ êµ¬ë§ˆ', 'ê³ êµ¬ë§ˆìˆœ': 'ê³ êµ¬ë§ˆìˆœ',
        'ìƒê°•': 'ìƒê°•', 'ìš°ì—‰': 'ìš°ì—‰', 'ì—°ê·¼': 'ì—°ê·¼',
        
        // ê³¡ë¬¼ë¥˜
        'ë²¼': 'ë²¼', 'ìŒ€': 'ìŒ€', 'ë³´ë¦¬': 'ë³´ë¦¬', 'ë°€': 'ë°€', 'ì˜¥ìˆ˜ìˆ˜': 'ì˜¥ìˆ˜ìˆ˜',
        'íŒ¥': 'íŒ¥', 'ë…¹ë‘': 'ë…¹ë‘', 'ìˆ˜ìˆ˜': 'ìˆ˜ìˆ˜', 'ì¡°': 'ì¡°', 'ê¸°ì¥': 'ê¸°ì¥', 'ì°¸ê¹¨': 'ì°¸ê¹¨'
      };

      // ì‘ì—… í‚¤ì›Œë“œ (í™•ì¥)
      const works = {
        // ìˆ˜í™• ê´€ë ¨
        'ìˆ˜í™•': 'ìˆ˜í™•', 'ìˆ˜í™•í•˜ë‹¤': 'ìˆ˜í™•', 'ìˆ˜í™•í–ˆë‹¤': 'ìˆ˜í™•', 'ìˆ˜í™•í–ˆì–´': 'ìˆ˜í™•',
        'ë”°': 'ìˆ˜í™•', 'ë”°ë‹¤': 'ìˆ˜í™•', 'ë•„': 'ìˆ˜í™•', 'ë•„ì–´': 'ìˆ˜í™•', 'ë”°ê¸°': 'ìˆ˜í™•',
        'ìº¤': 'ìˆ˜í™•', 'ìºë‹¤': 'ìˆ˜í™•', 'ìºê¸°': 'ìˆ˜í™•', 'ìº¤ì–´': 'ìˆ˜í™•',
        'ë² ': 'ìˆ˜í™•', 'ë² ë‹¤': 'ìˆ˜í™•', 'ë² ê¸°': 'ìˆ˜í™•', 'ë² ì—ˆ': 'ìˆ˜í™•',
        'ê±°ë‘': 'ìˆ˜í™•', 'ê±°ë‘ë‹¤': 'ìˆ˜í™•', 'ê±°ë‘ê¸°': 'ìˆ˜í™•',
        
        // ì¬ë°° ê´€ë¦¬
        'ë¬¼ì£¼ê¸°': 'ë¬¼ì£¼ê¸°', 'ë¬¼': 'ë¬¼ì£¼ê¸°', 'ê´€ìˆ˜': 'ê´€ìˆ˜', 'ê¸‰ìˆ˜': 'ê´€ìˆ˜',
        'ê±°ë¦„': 'ë¹„ë£Œ ì‚´í¬', 'ë¹„ë£Œ': 'ë¹„ë£Œ ì‚´í¬', 'í‡´ë¹„': 'í‡´ë¹„ ì‚´í¬',
        'ë³µí•©ë¹„ë£Œ': 'ë³µí•©ë¹„ë£Œ ì‚´í¬', 'ìœ ê¸°ë†ë¹„ë£Œ': 'ìœ ê¸°ë†ë¹„ë£Œ ì‚´í¬',
        'ì•¡ë¹„': 'ì•¡ë¹„ ì‚´í¬', 'ì—½ë©´ì‹œë¹„': 'ì—½ë©´ì‹œë¹„',
        
        // ë†ì•½ ì‚´í¬
        'ì˜ì–‘ì œ': 'ì˜ì–‘ì œ ì‚´í¬', 'ì‚´í¬': 'ì•½ì œ ì‚´í¬', 'ë¿Œë¦¬': 'ì•½ì œ ì‚´í¬',
        'ë†ì•½': 'ë†ì•½ ì‚´í¬', 'ì•½': 'ì•½ì œ ì‚´í¬', 'ì•½ì¹˜ê¸°': 'ì•½ì œ ì‚´í¬',
        'ì‚´ì¶©ì œ': 'ì‚´ì¶©ì œ ì‚´í¬', 'ë²Œë ˆì•½': 'ì‚´ì¶©ì œ ì‚´í¬',
        'ì‚´ê· ì œ': 'ì‚´ê· ì œ ì‚´í¬', 'ê³°íŒ¡ì´ì•½': 'ì‚´ê· ì œ ì‚´í¬',
        'ì œì´ˆì œ': 'ì œì´ˆì œ ì‚´í¬', 'í’€ì•½': 'ì œì´ˆì œ ì‚´í¬',
        'ì¹œí™˜ê²½ì œ': 'ì¹œí™˜ê²½ìì¬ ì‚´í¬', 'ìœ ê¸°ë†ì œ': 'ìœ ê¸°ë†ìì¬ ì‚´í¬',
        'ë¯¸ìƒë¬¼ì œ': 'ë¯¸ìƒë¬¼ì œ ì‚´í¬', 'ì²œì—°ì‚´ì¶©ì œ': 'ì²œì—°ì‚´ì¶©ì œ ì‚´í¬',
        
        // ë†ì‘ì—…
        'ì œì´ˆ': 'ì œì´ˆ', 'í’€': 'ì œì´ˆ', 'í’€ë² ê¸°': 'ì œì´ˆ', 'í’€ë½‘ê¸°': 'ì œì´ˆ',
        'ê°€ì§€ì¹˜ê¸°': 'ê°€ì§€ì¹˜ê¸°', 'ì „ì •': 'ê°€ì§€ì¹˜ê¸°', 'ìˆœì§€ë¥´ê¸°': 'ìˆœì§€ë¥´ê¸°',
        'ì ê³¼': 'ì ê³¼', 'ì†ì•„ë‚´ê¸°': 'ì ê³¼', 'ë´‰ì§€ì”Œìš°ê¸°': 'ë´‰ì§€ì”Œìš°ê¸°',
        'ì§€ì£¼ì„¸ìš°ê¸°': 'ì§€ì£¼ì„¸ìš°ê¸°', 'ì§€ì£¼': 'ì§€ì£¼ì„¸ìš°ê¸°',
        
        // ì¶œí•˜/íŒë§¤
        'ì¶œí•˜': 'ì¶œí•˜', 'ì¶œí•˜í•˜ë‹¤': 'ì¶œí•˜', 'ì¶œí•˜í–ˆì–´': 'ì¶œí•˜',
        'íŒë§¤': 'íŒë§¤', 'íŒ”': 'íŒë§¤', 'íŒ”ì•˜': 'íŒë§¤', 'íŒ”ë‹¤': 'íŒë§¤',
        'ë°°ì†¡': 'ë°°ì†¡', 'ë‚©í’ˆ': 'ë‚©í’ˆ', 'ì§ê±°ë˜': 'ì§ê±°ë˜', 'ë„ë§¤': 'ë„ë§¤',
        
        // ê¸°íƒ€
        'ì„ ë³„': 'ì„ ë³„', 'í¬ì¥': 'í¬ì¥', 'ì €ì¥': 'ì €ì¥', 'ë³´ê´€': 'ë³´ê´€',
        'ì •ë¦¬': 'ì •ë¦¬', 'ì •ë¹„': 'ì •ë¹„', 'ì²­ì†Œ': 'ì²­ì†Œ'
      };

      // í’ˆì§ˆ ë“±ê¸‰ (í™•ì¥)
      const grades = {
        'íŠ¹': 'íŠ¹', 'íŠ¹í’ˆ': 'íŠ¹í’ˆ',
        'ìƒ': 'ìƒ', 'ìƒí’ˆ': 'ìƒí’ˆ',
        'ì¤‘': 'ì¤‘', 'ì¤‘í’ˆ': 'ì¤‘í’ˆ',
        'í•˜': 'í•˜', 'í•˜í’ˆ': 'í•˜í’ˆ',
        'Aê¸‰': 'Aê¸‰', 'Bê¸‰': 'Bê¸‰', 'Cê¸‰': 'Cê¸‰',
        '1ë“±ê¸‰': '1ë“±ê¸‰', '2ë“±ê¸‰': '2ë“±ê¸‰', '3ë“±ê¸‰': '3ë“±ê¸‰'
      };

      // ì €ì¥ ì¥ì†Œ (í™•ì¥)
      const storage = {
        'ì°½ê³ ': 'ì°½ê³ ', 'ëƒ‰ì¥ê³ ': 'ëƒ‰ì¥ê³ ', 'ì €ì˜¨ì°½ê³ ': 'ì €ì˜¨ì°½ê³ ', 
        'ê±´ì¡°ì¥': 'ê±´ì¡°ì¥', 'ì €ì¥': 'ì €ì¥ì†Œ', 'ë³´ê´€': 'ë³´ê´€ì†Œ',
        'ëƒ‰ë™': 'ëƒ‰ë™ê³ ', 'ì‹¤ì˜¨': 'ì‹¤ì˜¨ì €ì¥'
      };

      // ì¶œí•˜ì²˜/íŒë§¤ì²˜ (í™•ì¥)
      const destination = {
        'ë†í˜‘': 'ë†í˜‘', 'ì§ê±°ë˜': 'ì§ê±°ë˜', 'ë§ˆíŠ¸': 'ë§ˆíŠ¸', 
        'ëŒ€í˜•ë§ˆíŠ¸': 'ëŒ€í˜•ë§ˆíŠ¸', 'ì‹œì¥': 'ì‹œì¥', 'ë„ë§¤ì‹œì¥': 'ë„ë§¤ì‹œì¥',
        'ì˜¨ë¼ì¸': 'ì˜¨ë¼ì¸', 'ë¡œì»¬í‘¸ë“œ': 'ë¡œì»¬í‘¸ë“œ', 
        'ì§íŒì¥': 'ì§íŒì¥', 'ì†Œë¹„ì': 'ì†Œë¹„ì'
      };

      let crop = '';
      let work = '';
      let quantity = '';
      let unit = '';
      let grade = '';
      let storagePlace = '';
      let dest = '';

      // ì‘ë¬¼ ì¸ì‹
      for (let key in crops) {
        if (text.includes(key)) {
          crop = crops[key];
          break;
        }
      }

      // ì‘ì—… ì¸ì‹
      for (let key in works) {
        if (text.includes(key)) {
          work = works[key];
          break;
        }
      }

      // í’ˆì§ˆ ë“±ê¸‰ ì¸ì‹
      for (let key in grades) {
        if (text.includes(key)) {
          grade = grades[key];
          break;
        }
      }

      // ì €ì¥ ì¥ì†Œ ì¸ì‹
      for (let key in storage) {
        if (text.includes(key)) {
          storagePlace = storage[key];
          break;
        }
      }

      // ì¶œí•˜ì²˜ ì¸ì‹
      for (let key in destination) {
        if (text.includes(key)) {
          dest = destination[key];
          break;
        }
      }

      // ìˆ˜ëŸ‰ ë° ë‹¨ìœ„ ì¶”ì¶œ (í™•ì¥)
      const quantityMatch = text.match(/(\d+(?:\.\d+)?)\s*(kg|í‚¬ë¡œ|í‚¤ë¡œ|ë°•ìŠ¤|ìƒì|ê°œ|í¬ê¸°|ë‹¨|í†¤|ê·¸ë¨|g|í¬ëŒ€|ìë£¨|ë§|ì†¡ì´|ë‹¤ë°œ|ë¦¬í„°|L|ë°°ì•¡|ë°°)/i);
      if (quantityMatch) {
        quantity = quantityMatch[1];
        let rawUnit = quantityMatch[2];
        if (rawUnit.includes('í‚¬ë¡œ') || rawUnit.includes('í‚¤ë¡œ')) {
          unit = 'kg';
        } else if (rawUnit.includes('ë°•ìŠ¤') || rawUnit.includes('ìƒì')) {
          unit = 'ë°•ìŠ¤';
        } else if (rawUnit === 'ê°œ') {
          unit = 'ê°œ';
        } else if (rawUnit === 'í¬ê¸°') {
          unit = 'í¬ê¸°';
        } else if (rawUnit === 'ë‹¨') {
          unit = 'ë‹¨';
        } else if (rawUnit === 'í†¤') {
          unit = 'í†¤';
        } else if (rawUnit.includes('ê·¸ë¨') || rawUnit === 'g') {
          unit = 'g';
        } else if (rawUnit === 'í¬ëŒ€' || rawUnit === 'ìë£¨') {
          unit = 'í¬ëŒ€';
        } else if (rawUnit === 'ë§') {
          unit = 'ë§';
        } else if (rawUnit === 'ì†¡ì´') {
          unit = 'ì†¡ì´';
        } else if (rawUnit === 'ë‹¤ë°œ') {
          unit = 'ë‹¤ë°œ';
        } else if (rawUnit.includes('ë¦¬í„°') || rawUnit === 'L') {
          unit = 'L';
        } else if (rawUnit.includes('ë°°ì•¡') || rawUnit === 'ë°°') {
          unit = 'ë°°ì•¡';
        } else {
          unit = rawUnit;
        }
      }

      return {
        id: Date.now(),
        date: dateStr,
        rawText: text,
        crop: crop || 'ë¯¸ë¶„ë¥˜',
        work: work || 'ê¸°íƒ€ ì‘ì—…',
        quantity: quantity || '-',
        unit: unit || '',
        grade: grade || '-',
        storage: storagePlace || '-',
        destination: dest || '-',
        temperature: null,
        humidity: null
      };
    }

    // í˜„ì¬ ê¸°ë¡ í‘œì‹œ
    function displayCurrentRecord(record) {
      const html = `
        <div class="record-card" style="animation: fadeIn 0.5s;">
          <div class="record-header">
            <span class="record-date">âœ… ë°©ê¸ˆ ê¸°ë¡í•œ ë‚´ìš©</span>
          </div>
          <div class="raw-text">"${record.rawText}"</div>
          <div class="record-info">
            <div class="info-item">
              <div class="info-label">ğŸ“… ë‚ ì§œ/ì‹œê°„</div>
              <div class="info-value">${record.date}</div>
            </div>
            <div class="info-item">
              <div class="info-label">ğŸŒ± ì‘ë¬¼</div>
              <div class="info-value">${record.crop}</div>
            </div>
            <div class="info-item">
              <div class="info-label">ğŸ”§ ì‘ì—…</div>
              <div class="info-value">${record.work}</div>
            </div>
            <div class="info-item">
              <div class="info-label">ğŸ“¦ ìˆ˜ëŸ‰</div>
              <div class="info-value">${record.quantity}${record.unit}</div>
            </div>
            <div class="info-item">
              <div class="info-label">â­ í’ˆì§ˆ/ë“±ê¸‰</div>
              <div class="info-value">${record.grade}</div>
            </div>
            <div class="info-item">
              <div class="info-label">ğŸ­ ì €ì¥ ì¥ì†Œ</div>
              <div class="info-value">${record.storage}</div>
            </div>
            <div class="info-item">
              <div class="info-label">ğŸª ì¶œí•˜ì²˜</div>
              <div class="info-value">${record.destination}</div>
            </div>
            <div class="info-item">
              <div class="info-label">ğŸŒ¡ï¸ ì˜¨ë„</div>
              <div class="info-value">${record.temperature || '-'}â„ƒ</div>
            </div>
            <div class="info-item">
              <div class="info-label">ğŸ’§ ìŠµë„</div>
              <div class="info-value">${record.humidity || '-'}%</div>
            </div>
          </div>
        </div>
      `;
      document.getElementById('currentRecordDisplay').innerHTML = html;
    }

    // ê¸°ë¡ ëª©ë¡ í‘œì‹œ
    function displayRecordsList() {
      const container = document.getElementById('recordsList');
      const titleElement = document.getElementById('recordsTitle');
      
      if (records.length === 0) {
        titleElement.textContent = 'ğŸ“‹ ê¸°ë¡ ëª©ë¡ (0ê°œ)';
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“</div>
            <p>ì•„ì§ ê¸°ë¡ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <p>ìŒì„±ì´ë‚˜ í…ìŠ¤íŠ¸ë¡œ ì²« ê¸°ë¡ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>
          </div>
        `;
        return;
      }

      titleElement.textContent = `ğŸ“‹ ê¸°ë¡ ëª©ë¡ (ì´ ${records.length}ê°œ)`;

      // ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™”
      const groupedByDate = {};
      records.forEach(record => {
        const dateOnly = record.date.split(' ')[0]; // ë‚ ì§œë§Œ ì¶”ì¶œ
        if (!groupedByDate[dateOnly]) {
          groupedByDate[dateOnly] = [];
        }
        groupedByDate[dateOnly].push(record);
      });

      // ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
      const sortedDates = Object.keys(groupedByDate).sort().reverse();

      const html = sortedDates.map(date => {
        const dayRecords = groupedByDate[date];
        const recordsHtml = dayRecords.map((record, index) => `
          <div style="padding: 10px; background: ${index % 2 === 0 ? '#f8f9fa' : '#ffffff'}; border-radius: 8px; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <span style="color: #6c757d; font-size: 14px;">${record.date.split(' ')[1]}</span>
              <button class="delete-btn" style="font-size: 12px; padding: 5px 10px;" onclick="deleteRecord(${record.id})">ğŸ—‘ï¸ ì‚­ì œ</button>
            </div>
            <div class="raw-text" style="margin-bottom: 8px;">"${record.rawText}"</div>
            <div class="record-info" style="grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px;">
              <div class="info-item" style="padding: 8px;">
                <div class="info-label">ğŸŒ± ì‘ë¬¼</div>
                <div class="info-value">${record.crop}</div>
              </div>
              <div class="info-item" style="padding: 8px;">
                <div class="info-label">ğŸ”§ ì‘ì—…</div>
                <div class="info-value">${record.work}</div>
              </div>
              <div class="info-item" style="padding: 8px;">
                <div class="info-label">ğŸ“¦ ìˆ˜ëŸ‰</div>
                <div class="info-value">${record.quantity}${record.unit}</div>
              </div>
              <div class="info-item" style="padding: 8px;">
                <div class="info-label">â­ í’ˆì§ˆ</div>
                <div class="info-value">${record.grade}</div>
              </div>
              <div class="info-item" style="padding: 8px;">
                <div class="info-label">ğŸ­ ì €ì¥</div>
                <div class="info-value">${record.storage}</div>
              </div>
              <div class="info-item" style="padding: 8px;">
                <div class="info-label">ğŸª ì¶œí•˜ì²˜</div>
                <div class="info-value">${record.destination}</div>
              </div>
              <div class="info-item" style="padding: 8px;">
                <div class="info-label">ğŸŒ¡ï¸ ì˜¨ë„</div>
                <div class="info-value">${record.temperature || '-'}â„ƒ</div>
              </div>
              <div class="info-item" style="padding: 8px;">
                <div class="info-label">ğŸ’§ ìŠµë„</div>
                <div class="info-value">${record.humidity || '-'}%</div>
              </div>
            </div>
          </div>
        `).join('');

        return `
          <div class="record-card">
            <div class="record-header">
              <span class="record-date">ğŸ“… ${date}</span>
              <span style="color: #6c757d; font-size: 14px;">(${dayRecords.length}ê°œ ê¸°ë¡)</span>
            </div>
            ${recordsHtml}
          </div>
        `;
      }).join('');
      
      container.innerHTML = html;
    }

    // ê¸°ë¡ ì‚­ì œ
    function deleteRecord(id) {
      if (confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        records = records.filter(r => r.id !== id);
        saveRecords();
        updateAllDisplays();
      }
    }

    // ì˜ë†ì¼ì§€ ìƒì„±
    function generateDiary() {
      const year = document.getElementById('diaryYear').value || new Date().getFullYear();
      const month = document.getElementById('diaryMonth').value || (new Date().getMonth() + 1);
      
      const filteredRecords = records.filter(r => {
        const recordDate = new Date(r.date);
        return recordDate.getFullYear() == year && (recordDate.getMonth() + 1) == month;
      });

      const container = document.getElementById('diaryOutput');

      if (filteredRecords.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“…</div>
            <p>${year}ë…„ ${month}ì›”ì— ê¸°ë¡ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        `;
        return;
      }

      // ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™”
      const groupedByDate = {};
      filteredRecords.forEach(record => {
        const dateOnly = record.date.split(' ')[0];
        const dateObj = new Date(dateOnly);
        const dayOfMonth = dateObj.getDate();
        const dayOfWeek = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][dateObj.getDay()];
        const timeOnly = record.date.split(' ')[1];
        const dateKey = `${month}/${dayOfMonth}`;
        
        if (!groupedByDate[dateKey]) {
          groupedByDate[dateKey] = {
            date: dateOnly,
            dayOfWeek: dayOfWeek,
            records: []
          };
        }
        groupedByDate[dateKey].records.push({...record, time: timeOnly});
      });

      // ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
      const sortedDates = Object.keys(groupedByDate).sort((a, b) => {
        const dayA = parseInt(a.split('/')[1]);
        const dayB = parseInt(b.split('/')[1]);
        return dayA - dayB;
      });

      let html = `
        <div class="diary-title">ì˜ë†ì¼ì§€</div>
        <div style="text-align: center; margin-bottom: 30px; font-size: 18px; color: #495057;">
          ${year}ë…„ ${month}ì›”
        </div>
        <table class="diary-table">
          <thead>
            <tr>
              <th style="width: 80px;">ë‚ ì§œì¼</th>
              <th style="width: 60px;">ì‹œê°</th>
              <th style="width: 200px;">ì£¼ìš” ë†ì‘ì—…</th>
              <th style="width: 150px;">ë†ìì¬ ì‚¬ìš©ë‚´ì—­<br>(ë¹„ë£Œ, ì•½ì œ)</th>
              <th style="width: 250px;">ìƒì‚°, ì¶œí•˜ ë‚´ì—­</th>
              <th style="width: 80px;">ì˜¨ë„<br>(â„ƒ)</th>
              <th style="width: 80px;">ìŠµë„<br>(%)</th>
            </tr>
          </thead>
          <tbody>
            ${sortedDates.map(dateKey => {
              const dayData = groupedByDate[dateKey];
              const dayRecords = dayData.records;
              
              // ì£¼ìš” ë†ì‘ì—… ì •ë¦¬
              const mainWorks = dayRecords
                .filter(r => r.work && r.work !== 'ê¸°íƒ€ ì‘ì—…' && !r.work.includes('ì¶œí•˜') && !r.work.includes('íŒë§¤'))
                .map(r => {
                  const workDetail = [];
                  if (r.crop !== 'ë¯¸ë¶„ë¥˜') workDetail.push(r.crop);
                  workDetail.push(r.work);
                  if (r.quantity !== '-') workDetail.push(`(${r.quantity}${r.unit})`);
                  return workDetail.join(' ');
                });
              
              // ë†ìì¬ ì‚¬ìš©ë‚´ì—­
              const materials = dayRecords
                .filter(r => r.work && (r.work.includes('ì˜ì–‘ì œ') || r.work.includes('ë¹„ë£Œ') || r.work.includes('ì‚´í¬') || r.work.includes('ì•½ì œ')))
                .map(r => {
                  const matDetail = [];
                  if (r.crop !== 'ë¯¸ë¶„ë¥˜') matDetail.push(r.crop);
                  matDetail.push(r.work);
                  return matDetail.join(' ');
                });
              
              // ìƒì‚°, ì¶œí•˜ ë‚´ì—­
              const production = dayRecords.map(r => {
                const prodDetail = [];
                if (r.crop !== 'ë¯¸ë¶„ë¥˜') prodDetail.push(r.crop);
                if (r.work.includes('ìˆ˜í™•') || r.work.includes('ì¶œí•˜') || r.work.includes('íŒë§¤')) {
                  prodDetail.push(r.work);
                }
                if (r.quantity !== '-') prodDetail.push(`(${r.quantity}${r.unit})`);
                if (r.grade !== '-') prodDetail.push(r.grade);
                if (r.destination !== '-') prodDetail.push(r.destination);
                if (r.storage !== '-') prodDetail.push(r.storage);
                return prodDetail.filter(d => d).join(' ');
              }).filter(p => p);

              // ì‹œê° í‘œì‹œ (ì²« ê¸°ë¡ ì‹œê°„ ë˜ëŠ” í‰ê·  ì‹œê°„)
              const firstTime = dayRecords[0].time || '-';
              
              // ì˜¨ë„ì™€ ìŠµë„ (í•´ë‹¹ ë‚ ì§œì˜ ì²« ë²ˆì§¸ ê¸°ë¡ì—ì„œ ê°€ì ¸ì˜¤ê¸°)
              const temperature = dayRecords[0].temperature ? `${dayRecords[0].temperature}` : '-';
              const humidity = dayRecords[0].humidity ? `${dayRecords[0].humidity}` : '-';

              return `
                <tr>
                  <td style="text-align: center;">
                    <div>${dateKey}</div>
                    <div style="font-size: 12px; color: #6c757d; margin-top: 2px;">${dayData.dayOfWeek}</div>
                  </td>
                  <td style="text-align: center;">${firstTime}</td>
                  <td>
                    ${mainWorks.length > 0 ? mainWorks.join('<br>') : '-'}
                  </td>
                  <td>
                    ${materials.length > 0 ? materials.join('<br>') : '-'}
                  </td>
                  <td>
                    ${production.length > 0 ? production.join('<br>') : '-'}
                  </td>
                  <td style="text-align: center;">${temperature}</td>
                  <td style="text-align: center;">${humidity}</td>
                </tr>
              `;
            }).join('')}
          </tbody>
        </table>
      `;

      container.innerHTML = html;
    }

    // í†µê³„ í‘œì‹œ
    function displayStats() {
      if (records.length === 0) {
        document.getElementById('overallStats').innerHTML = `
          <div class="empty-state">
            <p>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        `;
        return;
      }

      // ì „ì²´ í†µê³„ ê³„ì‚°
      const totalRecords = records.length;
      const uniqueCrops = new Set(records.map(r => r.crop).filter(c => c !== 'ë¯¸ë¶„ë¥˜'));
      const totalCrops = uniqueCrops.size;
      
      // ì‘ì—… ì¢…ë¥˜ ê³„ì‚°
      const uniqueWorks = new Set(records.map(r => r.work).filter(w => w !== 'ê¸°íƒ€ ì‘ì—…'));
      const totalWorks = uniqueWorks.size;

      // ì „ì²´ í†µê³„ í‘œì‹œ
      document.getElementById('overallStats').innerHTML = `
        <div class="stat-card" style="background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);">
          <div class="stat-number" style="color: #2d5016;">${totalCrops}</div>
          <div class="stat-label" style="color: #2d5016;">ì‘ë¬¼ ì¢…ë¥˜</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);">
          <div class="stat-number" style="color: #1a4d8f;">${uniqueWorks.size}</div>
          <div class="stat-label" style="color: #1a4d8f;">ì‘ì—… ì¢…ë¥˜</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);">
          <div class="stat-number" style="color: #5a1a8f;">${totalRecords}</div>
          <div class="stat-label" style="color: #5a1a8f;">ì´ ê¸°ë¡</div>
        </div>
      `;

      // ì‘ë¬¼ ë¶„ë¥˜ (ê³¼ìˆ˜ë¥˜, ì±„ì†Œë¥˜ ë“±)
      const cropCategories = {
        'ê³¼ìˆ˜ë¥˜': ['ì‚¬ê³¼', 'ë°°', 'í¬ë„', 'ë³µìˆ­ì•„', 'ê°', 'ê·¤', 'ìë‘', 'ì²´ë¦¬', 'ì‚´êµ¬'],
        'ì±„ì†Œë¥˜': ['í† ë§ˆí† ', 'ìƒì¶”', 'ë°°ì¶”', 'ë¬´', 'ê³ ì¶”', 'ì˜¤ì´', 'í˜¸ë°•', 'ê°€ì§€', 'íŒŒ', 'ì–‘íŒŒ', 'ë‹¹ê·¼'],
        'ë‘ë¥˜/ì„œë¥˜': ['ì½©', 'ê°ì', 'ê³ êµ¬ë§ˆ', 'ë•…ì½©'],
        'ê³¡ë¬¼ë¥˜': ['ìŒ€', 'ë³´ë¦¬', 'ë°€', 'ì˜¥ìˆ˜ìˆ˜']
      };

      // ì‘ë¬¼ë³„ ì¹´ìš´íŠ¸
      const cropCount = {};
      records.forEach(r => {
        if (r.crop !== 'ë¯¸ë¶„ë¥˜') {
          cropCount[r.crop] = (cropCount[r.crop] || 0) + 1;
        }
      });

      // ì‘ë¬¼ ë¶„ë¥˜ë³„ í†µê³„
      let cropStatsHtml = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">';
      
      for (const [category, crops] of Object.entries(cropCategories)) {
        const categoryCrops = crops.filter(c => cropCount[c] > 0);
        if (categoryCrops.length > 0) {
          cropStatsHtml += `
            <div>
              <h4 style="color: #667eea; margin-bottom: 10px;">${category} (${categoryCrops.length}ì¢…)</h4>
              <div class="category-list">
                ${categoryCrops.map(c => `<span class="category-tag">${c} (${cropCount[c]})</span>`).join('')}
              </div>
            </div>
          `;
        }
      }
      cropStatsHtml += '</div>';
      document.getElementById('cropStatsContent').innerHTML = cropStatsHtml;

      // ì‘ë¬¼ë³„ ìƒì„¸ í†µê³„
      const sortedCrops = Object.entries(cropCount).sort((a, b) => b[1] - a[1]);
      document.querySelector('#cropDetails .category-title').textContent = `ğŸ“Š ì‘ë¬¼ë³„ ê¸°ë¡ íšŸìˆ˜ (${sortedCrops.length}ì¢…)`;
      document.getElementById('cropDetailsContent').innerHTML = sortedCrops
        .map(([crop, count]) => `<span class="category-tag">${crop} (${count})</span>`)
        .join('');

      // ì‘ì—… ì¢…ë¥˜ í†µê³„
      const workCount = {};
      records.forEach(r => {
        if (r.work !== 'ê¸°íƒ€ ì‘ì—…') {
          workCount[r.work] = (workCount[r.work] || 0) + 1;
        }
      });
      const sortedWorks = Object.entries(workCount).sort((a, b) => b[1] - a[1]);
      document.querySelector('#workStats .category-title').textContent = `ğŸ”§ ì‘ì—… ì¢…ë¥˜ (${sortedWorks.length}ì¢…)`;
      document.getElementById('workStatsContent').innerHTML = sortedWorks
        .map(([work, count]) => `<span class="category-tag">${work} (${count})</span>`)
        .join('');

      // í’ˆì§ˆ/ë“±ê¸‰ í†µê³„
      const gradeCount = {};
      records.forEach(r => {
        if (r.grade !== '-') {
          gradeCount[r.grade] = (gradeCount[r.grade] || 0) + 1;
        }
      });
      const gradeEntries = Object.entries(gradeCount);
      if (gradeEntries.length > 0) {
        document.querySelector('#gradeStats .category-title').textContent = `â­ í’ˆì§ˆ/ë“±ê¸‰ (${gradeEntries.length}ì¢…)`;
        document.getElementById('gradeStatsContent').innerHTML = gradeEntries
          .sort((a, b) => b[1] - a[1])
          .map(([grade, count]) => `<span class="category-tag">${grade} (${count})</span>`)
          .join('');
        document.getElementById('gradeStats').style.display = 'block';
      } else {
        document.getElementById('gradeStats').style.display = 'none';
      }

      // ì €ì¥ ì¥ì†Œ í†µê³„
      const storageCount = {};
      records.forEach(r => {
        if (r.storage !== '-') {
          storageCount[r.storage] = (storageCount[r.storage] || 0) + 1;
        }
      });
      const storageEntries = Object.entries(storageCount);
      if (storageEntries.length > 0) {
        document.querySelector('#storageStats .category-title').textContent = `ğŸ­ ì €ì¥ ì¥ì†Œ (${storageEntries.length}ì¢…)`;
        document.getElementById('storageStatsContent').innerHTML = storageEntries
          .sort((a, b) => b[1] - a[1])
          .map(([storage, count]) => `<span class="category-tag">${storage} (${count})</span>`)
          .join('');
        document.getElementById('storageStats').style.display = 'block';
      } else {
        document.getElementById('storageStats').style.display = 'none';
      }

      // ì¶œí•˜ì²˜/íŒë§¤ì²˜ í†µê³„
      const destinationCount = {};
      records.forEach(r => {
        if (r.destination !== '-') {
          destinationCount[r.destination] = (destinationCount[r.destination] || 0) + 1;
        }
      });
      const destinationEntries = Object.entries(destinationCount);
      if (destinationEntries.length > 0) {
        document.querySelector('#destinationStats .category-title').textContent = `ğŸª ì¶œí•˜ì²˜/íŒë§¤ì²˜ (${destinationEntries.length}ì¢…)`;
        document.getElementById('destinationStatsContent').innerHTML = destinationEntries
          .sort((a, b) => b[1] - a[1])
          .map(([dest, count]) => `<span class="category-tag">${dest} (${count})</span>`)
          .join('');
        document.getElementById('destinationStats').style.display = 'block';
      } else {
        document.getElementById('destinationStats').style.display = 'none';
      }
    }

    // íƒ­ ì „í™˜
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(`${tabName}-tab`).classList.add('active');
      
      if (tabName === 'list') {
        displayRecordsList();
      } else if (tabName === 'diary') {
        generateDiary();
      } else if (tabName === 'stats') {
        displayStats();
      }
    }

    // ëª¨ë“  ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
    function updateAllDisplays() {
      displayRecordsList();
      displayStats();
    }

    // localStorageì— ì €ì¥
    function saveRecords() {
      localStorage.setItem('farmRecords', JSON.stringify(records));
    }

    // localStorageì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadRecords() {
      const saved = localStorage.getItem('farmRecords');
      if (saved) {
        records = JSON.parse(saved);
      }
      updateAllDisplays();
    }

    // ì—°ë„/ì›” ì„ íƒ ì˜µì…˜ ìƒì„±
    function initDiaryControls() {
      const yearSelect = document.getElementById('diaryYear');
      const monthSelect = document.getElementById('diaryMonth');
      
      // ì´ë¯¸ HTMLì— ì˜µì…˜ì´ ìˆìœ¼ë©´ ìŠ¤í‚µ
      if (yearSelect.options.length > 0 && monthSelect.options.length > 0) {
        return;
      }
      
      const currentYear = new Date().getFullYear();
      const currentMonth = new Date().getMonth() + 1;

      // ì—°ë„ ì˜µì…˜ì´ ì—†ìœ¼ë©´ ì¶”ê°€
      if (yearSelect.options.length === 0) {
        for (let y = currentYear - 2; y <= currentYear + 1; y++) {
          const option = document.createElement('option');
          option.value = y;
          option.textContent = `${y}ë…„`;
          if (y === currentYear) option.selected = true;
          yearSelect.appendChild(option);
        }
      }

      // ì›” ì˜µì…˜ì´ ì—†ìœ¼ë©´ ì¶”ê°€
      if (monthSelect.options.length === 0) {
        for (let m = 1; m <= 12; m++) {
          const option = document.createElement('option');
          option.value = m;
          option.textContent = `${m}ì›”`;
          if (m === currentMonth) option.selected = true;
          monthSelect.appendChild(option);
        }
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', () => {
      loadRecords();
      initDiaryControls();
      initSpeechRecognition();
      
      // í˜„ì¬ ì›”ì˜ ì˜ë†ì¼ì§€ ìë™ ìƒì„±
      if (records.length > 0) {
        generateDiary();
      }
    });
  </script>
</body>
</html>
